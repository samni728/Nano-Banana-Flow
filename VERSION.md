# 版本历史

本文档记录Gemini Auto PPT Generator插件的所有版本变更。

## 版本号规范

本项目遵循[语义化版本](https://semver.org/lang/zh-CN/)规范：

- **主版本号（Major）**：不兼容的API修改
- **次版本号（Minor）**：向下兼容的功能性新增
- **修订号（Patch）**：向下兼容的问题修正

格式：`主版本号.次版本号.修订号`

---

## [1.1.18] - 2025-12-05

### 📝 目录设置文案优化

**发布日期**：2025年12月5日
**作者**：GT

#### 交互简化

1.  **保存目录设置**
    -   ✅ 标签文案更新为 "保存目录 (默认为浏览器下载目录)"，信息更直观
    -   ✅ 移除了输入框下方的冗余提示文字，界面更清爽
    -   ✅ 保持了输入框的占位符提示，确保用户知道如何自定义路径

---

## [1.1.17] - 2025-12-05

### 📐 间距微调

**发布日期**：2025年12月5日
**作者**：GT

#### 布局优化

1.  **垂直间距收紧**
    -   ✅ 缩小了提示词统计信息与操作按钮之间的间距（24px -> 12px）
    -   ✅ 增强了信息与操作的关联性，减少了视觉断层
    -   ✅ 进一步优化了垂直空间的利用

---

## [1.1.16] - 2025-12-05

### 📐 顶部布局精简

**发布日期**：2025年12月5日
**作者**：GT

#### 布局调整

1.  **顶部信息重构**
    -   ✅ 移除了 "Ready" 状态指示器，界面更简洁
    -   ✅ 标题区域（英文名、中文名、版本号）统一调整为右对齐
    -   ✅ 优化了顶部空间的利用率，视觉重心更明确

---

## [1.1.15] - 2025-12-05

### 📝 引导文案优化

**发布日期**：2025年12月5日
**作者**：GT

#### 体验细节提升

1.  **输入框引导**
    -   ✅ 优化了提示词输入框的占位符文案，增加了具体示例（小猫、大猩猩）
    -   ✅ "保存目录"更名为"自定义保存目录"，表意更准确
2.  **视觉可读性**
    -   ✅ 底部提示文字（默认保存...）颜色调整为亮白色
    -   ✅ 输入框占位符文字颜色调整为半透明白
    -   ✅ 整体文字与深色背景的对比度得到显著提升

---

## [1.1.14] - 2025-12-05

### 📐 按钮尺寸优化

**发布日期**：2025年12月5日
**作者**：GT

#### 交互微调

1.  **按钮高度调整**
    -   ✅ 优化了操作区按钮的内边距（14px -> 10px）
    -   ✅ 视觉上更加紧凑精致，同时保持了易点击性
    -   ✅ 节省了垂直空间，让整体布局更协调

---

## [1.1.13] - 2025-12-05

### 📝 文案与排版微调

**发布日期**：2025年12月5日
**作者**：GT

#### 细节优化

1.  **标题排版**
    -   ✅ "大香蕉批量生图神器"字号微调放大
    -   ✅ 版本号位置调整至中文标题后，视觉更平衡
2.  **底部信息更新**
    -   ✅ 更新了加群引导文案
    -   ✅ 官网链接更新为 `https://gt.topgpt.us`

---

## [1.1.12] - 2025-12-05

### 🎨 视觉优化

**发布日期**：2025年12月5日
**作者**：GT

#### 文字可读性提升

1.  **字体增强**
    -   ✅ 标题字号增大至 24px，副标题增大至 14px
    -   ✅ 标签文字颜色调整为高亮白，并增加文字阴影
    -   ✅ 优化了文字与复杂背景的对比度，确保清晰易读

---

## [1.1.11] - 2025-12-05

### 🎨 视觉焕新

**发布日期**：2025年12月5日
**作者**：GT

#### 主题升级

1.  **全新背景设计**
    -   ✅ 采用 `nano_banana_theme_bg.png` 作为全屏底图
    -   ✅ 增加了专业的渐变遮罩效果，确保文字清晰可读
    -   ✅ 移除了旧版局部装饰，整体视觉更加沉浸、统一

---

## [1.1.10] - 2025-12-05

### 📐 布局优化

**发布日期**：2025年12月5日
**作者**：GT

#### 界面适配

1.  **输入框高度调整**
    -   ✅ 优化了输入框的最小/最大高度（140px - 240px）
    -   ✅ 确保底部二维码区域在任何情况下都能完整显示
    -   ✅ 提升了小屏幕设备上的使用体验

---

## [1.1.9] - 2025-12-05

### 🎨 样式微调

**发布日期**：2025年12月5日
**作者**：GT

#### 按钮样式优化

1.  **清空按钮重构**
    -   ✅ 样式对齐：改为浅灰色背景，与主按钮等宽
    -   ✅ 增加文字：添加"清空"文字，表意更清晰
    -   ✅ 视觉优化：完全复刻用户期望的UI风格

---

## [1.1.8] - 2025-12-05

### ✨ 界面升级

**发布日期**：2025年12月5日
**作者**：GT

#### 视觉与交互优化

1.  **界面高度增加**
    -   ✅ 插件高度增加至 650px，确保底部二维码完整显示
    -   ✅ 优化了整体布局空间

2.  **操作区重构**
    -   ✅ 按钮文案简化为"批量生成"
    -   ✅ 新增"清空提示词"按钮（🗑️），支持一键清空
    -   ✅ 按钮布局改为并排显示，操作更便捷

---

## [1.1.7] - 2025-12-05

### ✨ 功能增强

**发布日期**：2025年12月5日
**作者**：GT

#### 新增功能

1.  **实时提示词计数**
    -   ✅ 在输入框下方实时显示有效提示词数量
    -   ✅ 自动忽略空行，所见即所得
    -   ✅ 帮助用户在开始前确认任务数量

2.  **UI 体验优化**
    -   ✅ 增大了输入框的高度（最小 200px）
    -   ✅ 优化了输入体验，更适合批量编辑

---

## [1.1.6] - 2025-12-05

### 🐛 Bug修复

**发布日期**：2025年12月5日
**作者**：GT

#### 修复的问题

1.  **首张图片丢失修复**
    -   ✅ 修复了第一张图片有时无法被捕获的问题
    -   ✅ 增加了智能等待逻辑：确保新图片在DOM中出现后再进行捕获
    -   ✅ 解决了"Stop"按钮消失但图片尚未渲染导致的竞态条件

#### 技术改进

**content.js 流程优化：**
-   新增 `countValidImages()` 辅助函数
-   `captureCurrentImageUrl` 增加轮询等待机制（最长30秒）
-   生成流程中增加 `preGenerationImageCount` 记录

---

## [1.1.5] - 2025-12-05

### 🐛 Bug修复

**发布日期**：2025年12月5日
**作者**：GT

#### 修复的问题

1.  **批量下载逻辑修复**
    -   ✅ 修复了批量下载时只下载最后一张图片的问题
    -   ✅ 改为在每次生成后立即捕获图片URL
    -   ✅ 所有生成完成后，基于捕获的URL列表进行批量下载

#### 技术改进

**content.js 流程优化：**
-   新增 `batchImageUrls` 全局变量缓存URL
-   新增 `captureCurrentImageUrl(index)` 函数
-   新增 `batchDownloadImagesFromList(directory)` 函数替代旧的DOM查询逻辑

---

## [1.0.3] - 2025-12-03

### 🚀 重大优化

**发布日期**：2025年12月3日  
**作者**：GT

#### 核心改进

1. **连续生成流程优化**
   - ✅ 第一次点击"制作图片"进入生成界面后，保持在该界面
   - ✅ 后续图片在同一界面连续生成，无需返回主界面
   - ✅ 每次生成后只清空输入框，不关闭生成界面

2. **异步下载机制**
   - ✅ 图片下载改为异步执行，不阻塞后续生成
   - ✅ 下载和下一张图片生成可以并行进行
   - ✅ 大幅提升批量生成效率

3. **智能状态管理**
   - ✅ 仅在第一张图片时选择Nano Banana Pro模型
   - ✅ 后续图片复用已选择的模型
   - ✅ 添加`clearInputField()`函数清空输入框

#### 技术细节

**优化后的流程：**
```javascript
// 第一张图片
1. clickGenerateImageButton()  // 进入生成界面
2. inputPrompt()                // 输入提示词
3. clickSendButton()            // 提交
4. selectNanoBananaProModel()   // 选择模型（仅第一次）
5. waitForImageGeneration()     // 等待生成
6. downloadImageAsync()         // 异步下载

// 第二张及后续图片
1. clearInputField()            // 清空输入框（保持在生成界面）
2. inputPrompt()                // 输入新提示词
3. clickSendButton()            // 提交
4. waitForImageGeneration()     // 等待生成
5. downloadImageAsync()         // 异步下载
```

**性能提升：**
- 减少页面跳转，提升稳定性
- 异步下载节省等待时间
- 连续生成更流畅

---

## [1.0.2] - 2025-12-03


### 🐛 Bug修复

**发布日期**：2025年12月3日  
**作者**：GT

#### 修复的问题

1. **发送按钮未触发**
   - ✅ 修复提示词输入后未点击发送按钮的问题
   - ✅ 添加`clickSendButton()`函数先提交提示词
   - ✅ 然后再点击"制作图片"按钮

#### 技术改进

**content.js 流程修正：**
```javascript
// 正确的生成流程
1. clickGenerateImageButton()     // 先点击"制作图片"按钮
2. inputPrompt(prompt)             // 在图片生成界面输入提示词
3. clickSendButton()               // 点击发送/提交按钮 ← 新增
4. selectNanoBananaProModel()      // 选择Nano Banana Pro模型
5. waitForImageGeneration()        // 等待图片生成完成
6. downloadImage()                 // 下载图片
```

**关键修复：**
- 修正了操作顺序：先打开"制作图片"界面，再输入提示词
- 添加了发送按钮点击步骤，确保提示词被提交
- 发送按钮查找逻辑支持多种方式（aria-label、SVG图标等）

---

## [1.0.1] - 2025-12-03


### 🐛 Bug修复

**发布日期**：2025年12月3日  
**作者**：GT

#### 修复的问题

1. **消息传递错误**
   - ✅ 修复"Could not establish connection. Receiving end does not exist"错误
   - ✅ 添加自动content script注入机制
   - ✅ 改进popup和background之间的消息传递

2. **错误处理优化**
   - ✅ 添加更友好的错误提示信息
   - ✅ 区分不同类型的错误并给出具体解决方案
   - ✅ 添加超时处理和重试机制

3. **TabId管理**
   - ✅ 使用保存的tabId而不是查询活动标签页
   - ✅ 避免标签页切换导致的任务失败
   - ✅ 添加tab有效性验证

#### 技术改进

**popup.js：**
```javascript
// 自动注入content script
await chrome.scripting.executeScript({
  target: { tabId: tab.id },
  files: ['content.js']
});

// 传递tabId给background
const response = await chrome.runtime.sendMessage({
  action: 'startGeneration',
  prompts: prompts,
  tabId: tab.id
});
```

**background.js：**
```javascript
// 保存tabId避免标签页切换问题
let currentTabId = null;

async function handleStartGeneration(prompts, tabId) {
  currentTabId = tabId;
  // ...
}
```

#### 新增文档
- ✅ [TROUBLESHOOTING.md](file:///Users/gt/AI_Code/2.Antigravity%20Build/4.Nano%20Banana%20Pro%20Plugging/TROUBLESHOOTING.md) - 故障排除指南

---

## [1.0.0] - 2025-12-03


### 🎉 首次发布

**发布日期**：2025年12月3日  
**作者**：GT

### ✨ 新增功能

#### 核心功能
- ✅ 批量输入提示词功能
  - 支持多行输入，每行一个提示词
  - 自动按行分割并创建任务队列
  
- ✅ 自动生图功能
  - 自动在Gemini页面输入提示词
  - 自动点击"制作图片"按钮
  - 自动选择Nano Banana Pro模型
  - 智能等待图片生成完成

- ✅ 图片生成检测
  - 使用MutationObserver监听DOM变化
  - 检测`<img class="image loaded">`元素
  - 验证图片URL包含`googleusercontent.com`
  - 超时时间：90秒

- ✅ 自动下载功能
  - 使用fetch API获取图片（自动携带鉴权）
  - 转换为Data URL后下载
  - 自动命名：page1.png, page2.png...
  - 保存到默认下载文件夹

#### 用户界面
- ✅ 现代化Popup界面
  - 蓝紫色渐变主题（#667eea → #764ba2）
  - 圆角卡片设计
  - 平滑动画效果
  - 响应式布局

- ✅ 实时进度显示
  - 进度条动画
  - 当前/总数显示（如：2 / 5）
  - 状态消息提示
  - 完成后自动提示

- ✅ 错误处理
  - 输入验证
  - 页面检测
  - 超时提示
  - 友好的错误消息

#### 辅助功能
- ✅ 智能保存
  - 自动保存上次输入的提示词
  - 使用Chrome Storage API
  - 下次打开自动恢复

- ✅ 清空功能
  - 一键清空输入框
  - 重置进度显示

### 🏗️ 技术架构

#### 核心技术
- Manifest V3（Chrome最新标准）
- Content Script（页面交互）
- Service Worker（后台任务管理）
- Chrome APIs（Downloads、Storage、Scripting）

#### 文件结构
```
├── manifest.json          # 插件配置
├── popup.html            # 弹窗界面
├── popup.css             # 界面样式
├── popup.js              # 弹窗逻辑
├── content.js            # 内容脚本
├── background.js         # 后台服务
├── icons/                # 图标资源
├── README.md             # 使用说明
└── VERSION.md            # 本文件
```

#### 权限申请
- `activeTab`：访问当前标签页
- `downloads`：下载文件
- `storage`：存储数据
- `scripting`：注入脚本
- `https://gemini.google.com/*`：访问Gemini页面
- `https://*.googleusercontent.com/*`：下载图片

### 📋 已知限制

1. **页面依赖**
   - 仅支持 `https://gemini.google.com/app` 页面
   - 需要用户已登录Google账号

2. **模型固定**
   - 当前版本仅支持Nano Banana Pro模型
   - 未来版本将支持模型选择

3. **文件命名**
   - 固定格式：page{序号}.png
   - 未来版本将支持自定义前缀

4. **DOM依赖**
   - 依赖Gemini页面的DOM结构
   - 页面更新可能需要插件维护

### 🐛 已知问题

- 无

### 📝 开发笔记

- 使用MutationObserver确保准确检测图片生成完成
- 使用fetch API解决图片鉴权下载问题
- 任务队列顺序执行，避免并发冲突
- 添加详细的console日志便于调试

---

## 未来计划

### [1.1.0] - 计划中

**预计发布**：待定

#### 计划功能
- [ ] 支持自定义文件名前缀
- [ ] 支持选择不同的图片生成模型
- [ ] 添加批量下载压缩包功能
- [ ] 支持暂停/继续生成
- [ ] 添加生成历史记录

### [1.2.0] - 计划中

**预计发布**：待定

#### 计划功能
- [ ] 支持从文件导入提示词
- [ ] 支持导出生成记录
- [ ] 添加快捷键支持
- [ ] 支持多语言界面
- [ ] 优化性能和稳定性

### [2.0.0] - 远期规划

**预计发布**：待定

#### 计划功能
- [ ] 支持其他AI平台（ChatGPT、Claude等）
- [ ] 云端同步功能
- [ ] 团队协作功能
- [ ] API接口支持

---

## 版本对比

| 版本 | 发布日期 | 主要功能 | 状态 |
|------|---------|---------|------|
| 1.0.0 | 2025-12-03 | 批量生图、自动下载 | ✅ 已发布 |
| 1.1.0 | 待定 | 自定义设置 | 📋 计划中 |
| 1.2.0 | 待定 | 高级功能 | 📋 计划中 |
| 2.0.0 | 待定 | 多平台支持 | 💡 构思中 |

---

## 更新说明

### 如何更新插件

1. **自动更新**（Chrome Web Store版本）
   - Chrome会自动检测并更新插件
   - 无需手动操作

2. **手动更新**（开发者模式）
   - 下载最新版本文件
   - 在`chrome://extensions/`点击"重新加载"
   - 或删除旧版本，重新加载新版本

### 更新检查

- 在插件Popup界面查看当前版本号
- 访问项目GitHub页面查看最新版本

---

**感谢使用 Gemini Auto PPT Generator！** 🎉

如有问题或建议，欢迎提交Issue或Pull Request。
